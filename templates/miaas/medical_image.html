{% if not user_session or user_session.user_type != 'patient' %}
<script type="text/javascript">
location.replace({{ "'" }}{% url 'miaas:index' %}{{ "'" }});
</script>
{% endif %}

{% load staticfiles %}
{% load my_filters %}

{% include 'miaas/template_header.html' %}

<!-- custom css -->


{% include 'miaas/template_nav_patient.html' %}


<div class="container">
    <section class="section section-default">
    {% if image and intpr_list|is_list %}
        <div class="row">
            <div class="col-xs-12 col-title">
                <h2 class="text-primary" id="titleSubject">{{ image.subject }}</h2>
            </div>
            <form id="imageInfoForm" class="col-xs-12 col-form">
                <div class="form-container form-boxed form-horizontal row">
                    <div class="col-xs-12 form-group">
                        <label class="col-sm-3 col-md-2 control-label" for="imageSubejct" >Subject</label>
                        <div class="col-sm-9 col-md-4">
                            <input type="text" id="imageSubejct" name="imageSubejct" class="form-control"
                                   placeholder="Subject" required readonly value="{{ image.subject }}">
                        </div>
                    </div>

                    <div class="col-xs-12 form-group">
                        <label class="col-sm-3 col-md-2 control-label" for="imageType" >Image Type</label>
                        <div class="col-sm-9 col-md-4">
                            <select class="form-control" id="imageType" name="imageType" required disabled>
                                <option>CT</option>
                                <option>X-ray</option>
                                <option>MRI</option>
                                <option>EEG</option>
                                <option>ECG</option>
                                <option>EMG</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-6 col-md-overlay col-md-overlay-right form-group">
                        <label class="col-sm-3 col-md-4 control-label" for="medicalImage">Medical Image</label>
                        <div class="col-sm-9 col-md-8">
                            <input type="file" id="medicalImage" name="medicalImage" class="form-control"
                                   placeholder="Medical Image" required readonly>
                        </div>
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-6 col-md-overlay col-md-overlay-right
                                col-md-overlay-2 form-group medimage-preview-container">
                        <div class="medimage-preview-wrapper">
                            <div class="medimage-preview">
                                <div class="text-center text-warning" style="margin-top:86px;">Image Preview</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xs-12 form-group">
                        <label class="col-sm-3 col-md-2 control-label" for="takenDate" >Date</label>
                        <div class="col-sm-9 col-md-4">
                            <input type="date" id="date" name="takenDate" class="form-control"
                                   placeholder="Date" required readonly value="2016-02-02">
                        </div>
                    </div>

                    <div class="col-xs-12 form-group">
                        <label class="col-sm-3 col-md-2 control-label" for="takenFrom" >Taken From</label>
                        <div class="col-sm-9 col-md-4">
                            <select class="form-control" id="takenFrom" name="takenFrom" required disabled>
                                <option>Medical Clinic</option>
                                <option>Home</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-xs-12 form-group">
                        <label class="col-sm-3 col-md-2 control-label" for="takenPhysicianName" >Physician</label>
                        <div class="col-sm-9 col-md-4">
                            <input type="text" id="takenPhysicianName" name="takenPhysicianName" class="form-control"
                                   placeholder="Examining Physician" required readonly value="{{ image.physician }}">
                        </div>
                    </div>

                    <div class="col-xs-12 form-group">
                        <label class="col-sm-3 col-md-2 control-label" for="clinic" >Clinic Name</label>
                        <div class="col-sm-9 col-md-4">
                            <input type="text" id="clinic" name="clinic" class="form-control"
                                   placeholder="Place" required readonly value="{{ image.place }}">
                        </div>
                    </div>

                    <div class="col-xs-12 form-group">
                        <label class="col-sm-3 col-md-2 control-label" for="imageDescription" >Description</label>
                        <div class="col-sm-9 col-md-10">
                            <textarea type="textarea" id="imageDescription" name="imageDescription" class="form-control"
                                      placeholder="Description" rows="5" readonly>{{ image.description }}</textarea>
                        </div>
                    </div>

                    <div class="col-xs-12 form-btns-innerbox">
                        <div class="form-btns-container row">
                            <div class="col-xs-12 col-sm-9 col-sm-offset-3 col-md-4 col-md-offset-0 form-button">
                                <a id="btnRequest" class="btn btn-lg btn-primary btn-block"
                                   href="#" type="button">Request Interpretation</a>
                            </div>

                            {% if intpr_list|is_empty %}
                                <div id="btnFormDelete" class="col-xs-6 col-sm-4 col-sm-offset-3 col-md-3 col-md-offset-2 form-button">
                                    <button class="btn btn-lg btn-danger btn-block" type="button">Delete</button>
                                </div>
                                <div id="btnFormEdit" class="col-xs-6 col-sm-5 col-md-3 form-button">
                                    <button class="btn btn-lg btn-primary btn-block" type="button">Edit</button>
                                </div>
                                <div id="btnFormEditConfirm" class="col-xs-6 col-sm-5 col-md-3 form-button" style="display: none;">
                                    <button class="btn btn-lg btn-primary btn-block" type="submit">Confirm</button>
                                </div>
                            {% else %}
                                <div id="btnFormDelete" class="col-xs-12 col-sm-9 col-sm-offset-3 col-md-3 col-md-offset-5 form-button">
                                    <button class="btn btn-lg btn-danger btn-block" type="button">Delete</button>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </form>

            <form id="requestIntprForm" class="col-xs-12 col-form" style="display: none;">
                <div class="form-container form-boxed form-horizontal row">
                    <div class="col-xs-12 form-group">
                        <label class="col-sm-3 col-md-2 control-label no-pad-top" for="reqLevel"
                               style="padding-top: 7px;">Request Level</label>
                        <div class="col-xs-12 col-sm-6 col-md-10">
                            <select class="form-control" id="reqLevel" name="reqLevel" required>
                                <option value="1">{{ 1|intpr_level_string }}</option>
                                <option value="2" selected>{{ 2|intpr_level_string }}</option>
                                <option value="3">{{ 3|intpr_level_string }}</option>
                            </select>
                        </div>
                    </div>

                    <div id="reqSubjectGroup" class="col-xs-12 form-group">
                        <label class="col-sm-3 col-md-2 control-label no-pad-top" for="reqSubject" >Request Subject</label>
                        <div class="col-xs-12 col-sm-6 col-md-10">
                            <input type="text" id="reqSubject" name="reqSubject" class="form-control"
                                   placeholder="Subject" required>
                        </div>
                    </div>

                    <div id="reqMessageGroup" class="col-xs-12 form-group">
                        <label class="col-sm-3 col-md-2 control-label no-pad-top" for="reqMessage" >Request Message</label>
                        <div class="col-sm-9 col-md-10">
                            <textarea type="textarea" id="reqMessage" name="reqMessage" class="form-control"
                                      placeholder="Request Message" rows="5" required></textarea>
                        </div>
                    </div>

                    <div class="col-xs-12 form-btns-innerbox">
                        <div class="form-btns-container row">
                            <div id="btnFormReset" class="col-xs-6 col-sm-4 col-sm-offset-3 col-md-3 col-md-offset-6 form-button">
                                <button class="btn btn-lg btn-primary btn-block" type="reset">Reset</button>
                            </div>
                            <div id="btnFormConfirm" class="col-xs-6 col-sm-5 col-md-3 form-button">
                                <button class="btn btn-lg btn-primary btn-block" type="submit">Request</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div><!-- End of Image information Row -->

        {% for intpr in intpr_list %}
            <!-- to be loop -->
            <div class="row">
                <div class="col-xs-12 col-title">
                    <h3 class="text-success" id="itp1-title">Interpretation #1</h3>
                </div>
                <div class="col-xs-12 col-form">
                    <div class="form-container form-boxed form-horizontal row">
                        <div class="col-sm-12 form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label" >Physician ID</label>
                            <div class="col-xs-12 col-sm-9 col-md-4 control-text">
                                <span ><!--a href="#"-->{{ intpr.physician_id }}<!--/a--></span>
                            </div>

                            <label class="col-xs-12 col-sm-3 col-md-2 control-label" >Physician Name</label>
                            <div class="col-xs-12 col-sm-9 col-md-4 control-text">
                                <span >{{ intpr.intpr_id }}</span>
                            </div>
                        </div>
                        <div class="col-sm-12 form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label" >Level</label>
                            <div class="col-xs-12 col-sm-9 col-md-10 control-text">
                                <span >{{ intpr.level|intpr_level_string }}</span>
                            </div>
                        </div>
                        <div class="col-sm-12 form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label" >Summary</label>
                            <div class="col-xs-12 col-sm-9 col-md-10 control-text">
                                <span >{{ intpr.summary }}</span>
                            </div>
                        </div>
                        <div class="col-sm-12 form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label" >Interpretation</label>
                            <div class="col-xs-12 col-sm-9 col-md-10 control-text">
                                <div >{{ intpr.interpretation }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}

    {% else %}
        <script type="text/javascript">
            location.replace("{% url 'miaas:archive' %}");
        </script>
    {% endif %}
    </section>
</div>

<!-- Modal -->
<div class="modal fade" id="alertModal" tabindex="-1" role="dialog" aria-labelledby="alertModalTitle">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="alertModalTitle">Request Failed</h4>
        </div>
        <div class="modal-body">
        Request failed
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
        </div>
    </div>
</div>
<div class="modal fade" id="deleteImageConfirmModal" tabindex="-1" role="dialog" aria-labelledby="deleteImageConfirmTitle">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="deleteImageConfirmTitle">Confirm Delete</h4>
        </div>
        <div class="modal-body">
        Are you sure to delete this image?
        </div>
        <div class="modal-footer">
            <button id="btnDeleteCofirm" type="button" class="btn btn-default">Delete</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
        </div>
    </div>
</div>



{% include 'miaas/template_footer.html' %}

<!-- custom javascript -->
<script type="text/javascript">
    $('#imageType').val("{{ image.image_type }}").attr("selected", "selected");
    $('#takenFrom').val("{{ image.taken_from }}").attr("selected", "selected");

    var imageInfo = JSON.parse("{{ image | jsonstr }}");
</script>
<script src="{% static 'miass/js/medical_image.js' %}"></script>

</body>
</html>